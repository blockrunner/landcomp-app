# –û—Ü–µ–Ω–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –≤ LandComp

**–î–∞—Ç–∞**: 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **6.5/10**

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏, –Ω–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞** –∫ AI API.

---

## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ (8/10)

#### –ß—Ç–æ —Ö–æ—Ä–æ—à–æ:
- ‚úÖ **Clean Architecture**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ `domain`, `data`, `presentation` —Å–ª–æ–µ–≤
- ‚úÖ **4 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞**: –°–∞–¥–æ–≤–æ–¥, –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä, –°—Ç—Ä–æ–∏—Ç–µ–ª—å, –≠–∫–æ–ª–æ–≥
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ immutable `AIAgent` entity
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: SystemPrompt, expertiseAreas, quickStartSuggestions

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
lib/features/chat/
‚îú‚îÄ‚îÄ domain/entities/ai_agent.dart          # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ data/config/ai_agents_config.dart      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ presentation/widgets/agent_selector.dart # UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞
```

#### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```dart
class AIAgent {
  final String id;
  final String name;
  final String description;
  final IconData icon;
  final Color primaryColor;
  final String systemPrompt;           // ‚Üê –ü—Ä–æ–º–ø—Ç –¥–ª—è AI
  final List<String> quickStartSuggestions;
  final List<String> expertiseAreas;
}
```

**–û—Ü–µ–Ω–∫–∞**: –û—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã —Å—Ç–∞—Ç–∏—á–Ω—ã –∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç.

---

### 2. –£–º–Ω—ã–π –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ (7/10)

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- ‚úÖ **AgentSelector**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ **Keyword-based scoring**: ~200 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- ‚úÖ **Confidence scoring**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0.0-1.0)
- ‚úÖ **Out-of-scope detection**: –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

#### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞:
```dart
// lib/core/ai/agent_selector.dart
Future<AgentSelectionResult> selectAgent(String userQuery) async {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ out-of-scope
  if (_isOutOfScope(query)) {
    return AgentSelectionResult.outOfScope();
  }
  
  // 2. –ü–æ–¥—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
  for (final agentId in _agentKeywords.keys) {
    scores[agentId] = _calculateScore(query, _agentKeywords[agentId]);
  }
  
  // 3. –í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –±–∞–ª–ª–æ–º
  // 4. –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
}

int _calculateScore(String query, List<String> keywords) {
  // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: +3 –±–∞–ª–ª–∞
  // –ù–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü: +2 –±–∞–ª–ª–∞
  // –°–æ–¥–µ—Ä–∂–∏—Ç: +1 –±–∞–ª–ª
}
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:
- **Gardener**: —Ä–∞—Å—Ç–µ–Ω–∏–µ, —Ü–≤–µ—Ç–æ–∫, —Å–∞–¥, –æ–≥–æ—Ä–æ–¥, –ø–æ—Å–∞–¥–∫–∞, —É—Ö–æ–¥, —É–¥–æ–±—Ä–µ–Ω–∏–µ, –≤—Ä–µ–¥–∏—Ç–µ–ª–∏
- **Landscape Designer**: –ª–∞–Ω–¥—à–∞—Ñ—Ç, –¥–∏–∑–∞–π–Ω, –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞, –∑–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ—Ä–æ–∂–∫–∏, –≥–∞–∑–æ–Ω
- **Builder**: —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –¥–æ–º, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, —Å—Ç–µ–Ω—ã, –∫—Ä—ã—à–∞, –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- **Ecologist**: —ç–∫–æ–ª–æ–≥–∏—è, —É—Å—Ç–æ–π—á–∏–≤—ã–π, –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞, –∫–æ–º–ø–æ—Å—Ç, —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: Keyword matching –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É. –ù–∞–ø—Ä–∏–º–µ—Ä, "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Å–∞–¥ –∫—Ä–∞—Å–∏–≤—ã–º" –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç —Ç–æ—á–Ω—ã—Ö —Å–ª–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å embedding-based similarity –∏–ª–∏ ML-–º–æ–¥–µ–ª—å –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞.

---

### 3. –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (7.5/10)

#### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- ‚úÖ **Hive**: –ë—ã—Å—Ç—Ä–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ NoSQL —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ **JSON compression**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ attachments**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```dart
// lib/core/storage/chat_storage.dart
class ChatStorage {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  Future<void> saveSession(ChatSession session) async {
    if (!_validateSession(session)) {
      throw Exception('Session validation failed');
    }
    
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ
    final sessionData = session.toJson();
    final optimizedData = JsonUtils.optimizeImageData(sessionData);
    final sessionJson = JsonUtils.compressJson(optimizedData);
    
    await _chatBox.put(session.id, sessionJson);
  }
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  bool _validateSession(ChatSession session) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ ID, —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–ª–æ–∂–µ–Ω–∏–π
    // –õ–∏–º–∏—Ç—ã: 10MB –Ω–∞ attachment, 50MB –Ω–∞ session
  }
}
```

#### –ß—Ç–æ —Ö–æ—Ä–æ—à–æ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–µ—Å—Å–∏–π –ø–æ –¥–∞—Ç–µ
- –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π, —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞–∑–º–µ—Ä)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π. –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º.

---

### 4. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤ (9/10)

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤:
- ‚úÖ –†—É—Å—Å–∫–∏–π
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π

#### –õ–æ–∫–∞–ª–∏–∑—É–µ—Ç—Å—è:
- –ò–º—è –∞–≥–µ–Ω—Ç–∞
- –û–ø–∏—Å–∞–Ω–∏–µ
- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- Quick start suggestions
- Expertise areas

```dart
String getLocalizedSystemPrompt(String languageCode) {
  switch (id) {
    case 'gardener':
      return languageCode == 'ru' 
        ? '–¢—ã - –æ–ø—ã—Ç–Ω—ã–π —Å–∞–¥–æ–≤–æ–¥ —Å 20-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º...'
        : 'You are an experienced gardener with 20 years of experience...';
  }
}
```

**–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!** –ü–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏.

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ö–û–ù–¢–ï–ö–°–¢ –†–ê–ó–ì–û–í–û–†–ê (2/10)

#### **–°–∞–º–∞—è —Å–µ—Ä—å–µ–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–∞!**

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```dart
// lib/core/network/ai_service.dart
Future<String> sendToOpenAI({
  required String message,
  required String systemPrompt,
}) async {
  final response = await _dio.post(url, data: {
    'messages': [
      {'role': 'system', 'content': systemPrompt},
      {'role': 'user', 'content': message},  // ‚ùå –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!
    ],
  });
}
```

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫–∏–µ —Ä–æ–∑—ã –ª—É—á—à–µ –ø–æ—Å–∞–¥–∏—Ç—å –Ω–∞ –¥–∞—á–µ –≤ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ?"
AI: "–†–µ–∫–æ–º–µ–Ω–¥—É—é —Å–æ—Ä—Ç–∞: –ì–ª–æ—Ä–∏—è –î–µ–π, –ß–µ—Ä–Ω–∞—è –ú–∞–≥–∏—è..."

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê –∫–æ–≥–¥–∞ –∏—Ö –ª—É—á—à–µ —Å–∞–∂–∞—Ç—å?"
AI: ‚ùå "–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å–∞–¥–∏—Ç—å?"
     (AI –Ω–µ –ø–æ–º–Ω–∏—Ç, —á—Ç–æ —Ä–µ—á—å —à–ª–∞ –æ —Ä–æ–∑–∞—Ö!)
```

#### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- ‚ùå AI –Ω–µ –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–Ω—É–∂–¥–µ–Ω –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚ùå –†–µ–∑–∫–æ —Å–Ω–∏–∂–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ –∏ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤
- ‚ùå –ü–ª–æ—Ö–æ–π UX

#### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:
–í –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ —á–∞—Å—Ç–æ –∏–¥–µ—Ç –º–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–∞—è –±–µ—Å–µ–¥–∞:
1. "–ö–∞–∫–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è —Ç–µ–Ω–∏?"
2. "–ê —Å–∫–æ–ª—å–∫–æ –∏–º –Ω—É–∂–Ω–æ –≤–æ–¥—ã?"
3. "–ö–æ–≥–¥–∞ –∏—Ö –ø–µ—Ä–µ—Å–∞–∂–∏–≤–∞—Ç—å?"
4. "–ê —á–µ–º —É–¥–æ–±—Ä—è—Ç—å?"

–ë–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å - —ç—Ç–æ –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.

---

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª–∏–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (3/10)

#### –ü—Ä–æ–±–ª–µ–º—ã:
- ‚ùå –ù–µ—Ç –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
- ‚ùå –ù–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—é –ª–∏–º–∏—Ç–æ–≤ API (4096 —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è GPT-3.5, 128k –¥–ª—è GPT-4)

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```dart
// –í ChatSession —Ö—Ä–∞–Ω—è—Ç—Å—è –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –ª–∏–º–∏—Ç–∞
class ChatSession {
  final List<Message> messages;  // ‚Üê –ú–æ–∂–µ—Ç –±—ã—Ç—å 1000+ —Å–æ–æ–±—â–µ–Ω–∏–π
}
```

#### –†–∏—Å–∫–∏:
1. **API errors**: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –æ—à–∏–±–∫–∞ 400
2. **–í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–æ–∏—Ç –¥–µ–Ω–µ–≥
3. **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**: –ë–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç = –¥–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

### 3. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (5/10)

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```dart
// lib/features/chat/data/config/ai_agents_config.dart
static const AIAgent gardenerAgent = AIAgent(
  systemPrompt: '''
You are an experienced gardener with 20 years of experience...
''',  // ‚Üê –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω, –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
);
```

#### –ü—Ä–æ–±–ª–µ–º—ã:
- ‚ùå –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ
- ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–≥–∏–æ–Ω–µ/–∫–ª–∏–º–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå –ù–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå –ù–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–µ—Å—Å–∏–∏

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç:
```
–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç: "–¢—ã - —Å–∞–¥–æ–≤–æ–¥..."

+ –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º '–î–∞—á–∞ –≤ –ª–µ—Å—É'"
+ –†–µ–≥–∏–æ–Ω: "–ö–ª–∏–º–∞—Ç: –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ (–∑–æ–Ω–∞ 4)"
+ –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–µ –∑–µ–º–ª–µ–¥–µ–ª–∏–µ"
+ –ò—Å—Ç–æ—Ä–∏—è: "–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–±—Å—É–∂–¥–∞–ª–∏ —Ä–æ–∑—ã"
```

---

### 4. –ù–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ (4/10)

#### –ü—Ä–æ–±–ª–µ–º–∞:
–ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω—É–ª—è. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª:
- –†–µ–≥–∏–æ–Ω –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
- –†–∞–∑–º–µ—Ä —É—á–∞—Å—Ç–∫–∞
- –¢–∏–ø –ø–æ—á–≤—ã
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è

–í—Å—ë —ç—Ç–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏.

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–ö–†–ò–¢–ò–ß–ù–û)

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `AIService`:

```dart
// lib/core/network/ai_service.dart

Future<String> sendToOpenAI({
  required String message,
  required String systemPrompt,
  List<Message>? conversationHistory,  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  int maxHistoryMessages = 10,         // ‚Üê –î–û–ë–ê–í–ò–¢–¨
}) async {
  final messages = <Map<String, dynamic>>[
    {'role': 'system', 'content': systemPrompt},
  ];
  
  // –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
  if (conversationHistory != null) {
    // –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ typing, –Ω–µ errors)
    final relevantHistory = conversationHistory
        .where((m) => !m.isTyping && !m.isError)
        .toList()
        .reversed  // –û—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º
        .take(maxHistoryMessages)
        .toList()
        .reversed;
    
    for (final msg in relevantHistory) {
      messages.add({
        'role': msg.type == MessageType.user ? 'user' : 'assistant',
        'content': msg.content,
      });
    }
  }
  
  // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  messages.add({'role': 'user', 'content': message});
  
  final response = await _dio.post(url, data: {
    'model': model,
    'messages': messages,  // ‚Üê –¢–µ–ø–µ—Ä—å —Å –∏—Å—Ç–æ—Ä–∏–µ–π!
  });
  
  return response.data['choices'][0]['message']['content'];
}
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `ChatProvider`:

```dart
// lib/features/chat/presentation/providers/chat_provider.dart

Future<SmartAIResponse> _getSmartAIResponse(String userMessage) async {
  // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
  final history = _currentSession?.messages ?? [];
  
  final response = await _aiService.sendMessageWithSmartSelection(
    message: userMessage,
    conversationHistory: history,  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  );
  
  return response;
}
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**  
#### –°–ª–æ–∂–Ω–æ—Å—Ç—å: **–ù–∏–∑–∫–∞—è** (1-2 —á–∞—Å–∞)  
#### –≠—Ñ—Ñ–µ–∫—Ç: **–û–≥—Ä–æ–º–Ω—ã–π** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–µ–Ω—è–µ—Ç UX

---

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏

#### –°–æ–∑–¥–∞—Ç—å `ContextManager`:

```dart
// lib/core/ai/context_manager.dart

class ContextManager {
  // –õ–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  static const Map<String, int> TOKEN_LIMITS = {
    'gpt-3.5-turbo': 4096,
    'gpt-4': 8192,
    'gpt-4-turbo': 128000,
    'gemini-1.5-flash': 32768,
    'gemini-1.5-pro': 1048576,
  };
  
  /// –í—ã–±—Ä–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤
  static List<Message> getRelevantHistory({
    required List<Message> allMessages,
    required String currentMessage,
    required String systemPrompt,
    required String model,
    double safetyMargin = 0.8,  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 80% –ª–∏–º–∏—Ç–∞
  }) {
    final maxTokens = TOKEN_LIMITS[model] ?? 4096;
    final targetTokens = (maxTokens * safetyMargin).toInt();
    
    // –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    int usedTokens = estimateTokens(systemPrompt) + 
                     estimateTokens(currentMessage) +
                     100;  // –†–µ–∑–µ—Ä–≤ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
    
    final relevantMessages = <Message>[];
    
    // –ò–¥–µ–º —Å –∫–æ–Ω—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
    for (final msg in allMessages.reversed) {
      if (msg.isTyping || msg.isError) continue;
      
      final msgTokens = estimateTokens(msg.content);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
      if (usedTokens + msgTokens > targetTokens) {
        break;  // –î–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞
      }
      
      relevantMessages.insert(0, msg);
      usedTokens += msgTokens;
    }
    
    return relevantMessages;
  }
  
  /// –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤
  static int estimateTokens(String text) {
    // –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:
    // - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π: ~1 —Ç–æ–∫–µ–Ω = 4 —Å–∏–º–≤–æ–ª–∞
    // - –†—É—Å—Å–∫–∏–π: ~1 —Ç–æ–∫–µ–Ω = 2-3 —Å–∏–º–≤–æ–ª–∞ (–∏–∑-–∑–∞ UTF-8)
    // 
    // –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tiktoken
    final hasRussian = RegExp(r'[–∞-—è–ê-–Ø]').hasMatch(text);
    final divisor = hasRussian ? 2.5 : 4.0;
    
    return (text.length / divisor).ceil();
  }
  
  /// –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Å–µ—Å—Å–∏–∏
  static int calculateSessionTokens(ChatSession session) {
    return session.messages.fold<int>(0, (sum, msg) {
      return sum + estimateTokens(msg.content);
    });
  }
}
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

```dart
// –í AIService.sendToOpenAI()

Future<String> sendToOpenAI({
  required String message,
  required String systemPrompt,
  List<Message>? conversationHistory,
  String model = 'gpt-4',
}) async {
  List<Message> relevantHistory = [];
  
  if (conversationHistory != null) {
    relevantHistory = ContextManager.getRelevantHistory(
      allMessages: conversationHistory,
      currentMessage: message,
      systemPrompt: systemPrompt,
      model: model,
    );
  }
  
  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ messages —Å —É—á–µ—Ç–æ–º –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤...
}
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–í–´–°–û–ö–ò–ô**  
#### –°–ª–æ–∂–Ω–æ—Å—Ç—å: **–°—Ä–µ–¥–Ω—è—è** (3-4 —á–∞—Å–∞)  
#### –≠—Ñ—Ñ–µ–∫—Ç: **–í—ã—Å–æ–∫–∏–π** - —ç–∫–æ–Ω–æ–º–∏—è –¥–µ–Ω–µ–≥ + —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

---

### 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

#### –°–æ–∑–¥–∞—Ç—å `PromptBuilder`:

```dart
// lib/core/ai/prompt_builder.dart

class PromptBuilder {
  /// –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  static String buildEnhancedSystemPrompt({
    required AIAgent agent,
    required String languageCode,
    Project? currentProject,
    UserPreferences? preferences,
    Map<String, dynamic>? sessionContext,
  }) {
    final parts = <String>[];
    
    // 1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç–∞
    parts.add(agent.getLocalizedSystemPrompt(languageCode));
    
    // 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
    if (currentProject != null) {
      parts.add(_buildProjectContext(currentProject));
    }
    
    // 3. –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (preferences != null) {
      parts.add(_buildUserPreferences(preferences));
    }
    
    // 4. –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Å—Å–∏–∏
    if (sessionContext != null) {
      parts.add(_buildSessionContext(sessionContext));
    }
    
    // 5. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –æ—Ç–≤–µ—Ç–∞
    parts.add(_buildResponseGuidelines(languageCode));
    
    return parts.join('\n\n');
  }
  
  static String _buildProjectContext(Project project) {
    return '''
–ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê:
- –ù–∞–∑–≤–∞–Ω–∏–µ: ${project.title}
- –û–ø–∏—Å–∞–Ω–∏–µ: ${project.description ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
- –°–æ–∑–¥–∞–Ω: ${_formatDate(project.createdAt)}
- –°–æ–æ–±—â–µ–Ω–∏–π: ${project.messages.length}
''';
  }
  
  static String _buildUserPreferences(UserPreferences prefs) {
    return '''
–ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
- –†–µ–≥–∏–æ–Ω: ${prefs.region ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
- –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–æ–Ω–∞: ${prefs.climateZone ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
- –†–∞–∑–º–µ—Ä —É—á–∞—Å—Ç–∫–∞: ${prefs.plotSize ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
- –¢–∏–ø –ø–æ—á–≤—ã: ${prefs.soilType ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
- –°—Ç–∏–ª—å: ${prefs.preferredStyle ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
- –ë—é–¥–∂–µ—Ç: ${prefs.budgetLevel ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
- –û–ø—ã—Ç: ${prefs.experienceLevel ?? '–ù–µ —É–∫–∞–∑–∞–Ω'}
''';
  }
  
  static String _buildSessionContext(Map<String, dynamic> context) {
    final parts = ['–ö–û–ù–¢–ï–ö–°–¢ –°–ï–°–°–ò–ò:'];
    
    if (context['topics'] != null) {
      parts.add('- –û–±—Å—É–∂–¥–∞–µ–º—ã–µ —Ç–µ–º—ã: ${(context['topics'] as List).join(', ')}');
    }
    
    if (context['mentioned_plants'] != null) {
      parts.add('- –£–ø–æ–º—è–Ω—É—Ç—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è: ${(context['mentioned_plants'] as List).join(', ')}');
    }
    
    return parts.join('\n');
  }
  
  static String _buildResponseGuidelines(String languageCode) {
    return languageCode == 'ru'
        ? '''
–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
- –£—á–∏—Ç—ã–≤–∞–π —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –∫–ª–∏–º–∞—Ç
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ (—É–º–µ—Ä–µ–Ω–Ω–æ)
'''
        : '''
RESPONSE FORMAT:
- Answer in English
- Provide practical advice
- Be specific and helpful
- Use emojis moderately for clarity
''';
  }
}
```

#### –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π:

```dart
// lib/features/profile/domain/entities/user_preferences.dart

class UserPreferences {
  final String? region;           // "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"
  final String? climateZone;      // "–ó–æ–Ω–∞ 4"
  final String? plotSize;         // "6 —Å–æ—Ç–æ–∫"
  final String? soilType;         // "–°—É–≥–ª–∏–Ω–æ–∫"
  final String? preferredStyle;   // "–î–µ—Ä–µ–≤–µ–Ω—Å–∫–∏–π"
  final String? budgetLevel;      // "–°—Ä–µ–¥–Ω–∏–π"
  final String? experienceLevel;  // "–ù–∞—á–∏–Ω–∞—é—â–∏–π"
  
  // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ SharedPreferences –∏–ª–∏ Hive
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```dart
// –í ChatProvider._getSmartAIResponse()

final enhancedPrompt = PromptBuilder.buildEnhancedSystemPrompt(
  agent: selectedAgent,
  languageCode: _languageProvider?.currentLocale.languageCode ?? 'en',
  currentProject: projectProvider.currentProject,
  preferences: await _loadUserPreferences(),
);

final response = await _aiService.sendMessage(
  message: userMessage,
  systemPrompt: enhancedPrompt,  // ‚Üê –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
  conversationHistory: history,
);
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–°–†–ï–î–ù–ò–ô**  
#### –°–ª–æ–∂–Ω–æ—Å—Ç—å: **–°—Ä–µ–¥–Ω—è—è** (4-6 —á–∞—Å–æ–≤)  
#### –≠—Ñ—Ñ–µ–∫—Ç: **–°—Ä–µ–¥–Ω–∏–π** - –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤

---

### 4. –°–∂–∞—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π (100+ —Å–æ–æ–±—â–µ–Ω–∏–π) –º–æ–∂–Ω–æ —Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

```dart
// lib/core/ai/conversation_summarizer.dart

class ConversationSummarizer {
  final AIService _aiService;
  
  /// –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  Future<String> summarizeOldMessages(
    List<Message> oldMessages,
    String languageCode,
  ) async {
    final conversationText = oldMessages
        .map((m) => '${m.type.name}: ${m.content}')
        .join('\n\n');
    
    final summaryPrompt = languageCode == 'ru'
        ? '–°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã –∏ —Ä–µ—à–µ–Ω–∏—è:'
        : 'Create a brief summary of this conversation, preserving key facts and decisions:';
    
    final summary = await _aiService.sendMessage(
      message: '$summaryPrompt\n\n$conversationText',
      systemPrompt: 'You are a conversation summarizer. Be concise but thorough.',
    );
    
    return summary;
  }
  
  /// –£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é + summary —Å—Ç–∞—Ä—ã—Ö
  Future<List<Message>> getOptimizedHistory(
    List<Message> allMessages,
    int recentMessagesCount = 20,
  ) async {
    if (allMessages.length <= recentMessagesCount) {
      return allMessages;
    }
    
    final oldMessages = allMessages.take(allMessages.length - recentMessagesCount).toList();
    final recentMessages = allMessages.skip(allMessages.length - recentMessagesCount).toList();
    
    final summary = await summarizeOldMessages(oldMessages, 'ru');
    
    // –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å summary
    final summaryMessage = Message.system(
      id: 'summary_${DateTime.now().millisecondsSinceEpoch}',
      content: '–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:\n$summary',
    );
    
    return [summaryMessage, ...recentMessages];
  }
}
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–ù–ò–ó–ö–ò–ô**  
#### –°–ª–æ–∂–Ω–æ—Å—Ç—å: **–°—Ä–µ–¥–Ω—è—è** (3-4 —á–∞—Å–∞)  
#### –≠—Ñ—Ñ–µ–∫—Ç: **–ù–∏–∑–∫–∏–π** - –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π

---

### 5. ML-based –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í–º–µ—Å—Ç–æ keyword matching –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å embedding-based similarity:

```dart
// lib/core/ai/embedding_agent_selector.dart

class EmbeddingAgentSelector {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI Embeddings API –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å
  
  Future<AIAgent> selectAgentByEmbedding(String userQuery) async {
    // 1. –ü–æ–ª—É—á–∏—Ç—å embedding –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    final queryEmbedding = await _getEmbedding(userQuery);
    
    // 2. –í—ã—á–∏—Å–ª–∏—Ç—å similarity —Å –∫–∞–∂–¥—ã–º –∞–≥–µ–Ω—Ç–æ–º
    final scores = <String, double>{};
    for (final agent in AIAgentsConfig.getAllAgents()) {
      final agentEmbedding = await _getAgentEmbedding(agent);
      scores[agent.id] = _cosineSimilarity(queryEmbedding, agentEmbedding);
    }
    
    // 3. –í—ã–±—Ä–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º score
    final bestAgentId = scores.entries
        .reduce((a, b) => a.value > b.value ? a : b)
        .key;
    
    return AIAgentsConfig.getAgentById(bestAgentId)!;
  }
  
  Future<List<double>> _getEmbedding(String text) async {
    // OpenAI text-embedding-3-small
    // –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (sentence-transformers)
  }
  
  double _cosineSimilarity(List<double> a, List<double> b) {
    // –í—ã—á–∏—Å–ª–∏—Ç—å –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
  }
}
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–ù–ò–ó–ö–ò–ô**  
#### –°–ª–æ–∂–Ω–æ—Å—Ç—å: **–í—ã—Å–æ–∫–∞—è** (8-12 —á–∞—Å–æ–≤)  
#### –≠—Ñ—Ñ–µ–∫—Ç: **–°—Ä–µ–¥–Ω–∏–π** - –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞

---

## üìà –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ü–µ–Ω–∫–∞ | –ß—Ç–æ —Ö–æ—Ä–æ—à–æ | –ß—Ç–æ –ø–ª–æ—Ö–æ |
|-----------|--------|------------|-----------|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤** | 8/10 | Clean Architecture, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã |
| **–í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞** | 7/10 | –†–∞–±–æ—Ç–∞–µ—Ç, –µ—Å—Ç—å confidence | Keyword-based, –Ω–µ ML |
| **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** | 9/10 | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ru/en | - |
| **–•—Ä–∞–Ω–∏–ª–∏—â–µ** | 7.5/10 | –í–∞–ª–∏–¥–∞—Ü–∏—è, compression | –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª–∏–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π |
| **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** | 2/10 | –•—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ | ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ AI |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏** | 3/10 | - | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** | 6/10 | –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ, –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | 7/10 | Fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, retry | - |
| **UI –∞–≥–µ–Ω—Ç–æ–≤** | 8/10 | –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω | - |

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)
**–¶–µ–ª—å**: –ó–∞—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞—Ç—å

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `conversationHistory` –≤ `AIService.sendToOpenAI()` –∏ `sendToGemini()`
2. ‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10-20 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `ChatProvider`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `sendMessageWithSmartSelection()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: AI –Ω–∞—á–Ω–µ—Ç –ø–æ–º–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

---

### –§–∞–∑–∞ 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ (2-3 –¥–Ω—è)
**–¶–µ–ª—å**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞—Ç—Ä–∞—Ç

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `ContextManager`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `estimateTokens()`
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `getRelevantHistory()`
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `AIService`
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ UI

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ª–∏–º–∏—Ç–∞–º–∏ –∏ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏

---

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ (2-3 –¥–Ω—è)
**–¶–µ–ª—å**: –ü–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `PromptBuilder`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `UserPreferences`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –≤ UI
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

---

### –§–∞–∑–∞ 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–¶–µ–ª—å**: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. üî≤ –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
2. üî≤ ML-based –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞
3. üî≤ Semantic search –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
4. üî≤ –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Å—Å–∏–π

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫ —Å–µ—Å—Å–∏—è–º

```dart
class ChatSession {
  // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è...
  
  final Map<String, dynamic>? metadata;  // ‚Üê –ù–û–í–û–ï
  
  // –ü—Ä–∏–º–µ—Ä—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:
  // {
  //   'total_tokens': 1250,
  //   'mentioned_plants': ['—Ä–æ–∑–∞', '—Ç—é–ª—å–ø–∞–Ω'],
  //   'topics': ['–ø–æ—Å–∞–¥–∫–∞', '—É—Ö–æ–¥'],
  //   'region': '–ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ',
  //   'season': '–≤–µ—Å–Ω–∞'
  // }
}
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings –∞–≥–µ–Ω—Ç–æ–≤

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ML-based selection, –∫—ç—à–∏—Ä—É–π—Ç–µ embeddings:

```dart
// –û–¥–∏–Ω —Ä–∞–∑ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
class AgentEmbeddingCache {
  static final Map<String, List<double>> _cache = {};
  
  static Future<void> warmUp() async {
    for (final agent in AIAgentsConfig.getAllAgents()) {
      _cache[agent.id] = await _computeEmbedding(agent);
    }
  }
}
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:

```dart
class PromptAnalytics {
  void logResponse({
    required String agentId,
    required String promptVersion,
    required String userQuery,
    required String aiResponse,
    int? userRating,  // üëç/üëé
  }) {
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
  }
}
```

### 4. –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

–°–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è fine-tuning:

```dart
class ConversationExporter {
  Future<String> exportToJSONL(ChatSession session) async {
    // –§–æ—Ä–º–∞—Ç –¥–ª—è fine-tuning OpenAI
    final jsonl = session.messages.map((msg) {
      return jsonEncode({
        'role': msg.type == MessageType.user ? 'user' : 'assistant',
        'content': msg.content,
      });
    }).join('\n');
    
    return jsonl;
  }
}
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚ùå AI –Ω–µ –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω —Å–≤—è–∑–Ω—ã–π –¥–∏–∞–ª–æ–≥
- ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –†–∏—Å–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
- ‚ùå –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤—Å–µ—Ö

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚úÖ AI –ø–æ–º–Ω–∏—Ç –≤–µ—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä
- ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞—Ç—Ä–∞—Ç
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –£—á–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è:
- **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤**: +70%
- **–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: +80%
- **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –¥–∏–∞–ª–æ–≥**: +150%
- **Retention**: +40%

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–∏—Ç–æ–≥–æ)

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–≤–Ω–µ–¥—Ä–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. **–ü–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** - –±–µ–∑ —ç—Ç–æ–≥–æ —á–∞—Ç –ø–æ—á—Ç–∏ –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω
2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏** - –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ –∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞

### üü† –í–ê–ñ–ù–´–ï (–≤–Ω–µ–¥—Ä–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏):
3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã** - –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ
4. **–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π** - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

### üü° –ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ï (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):
5. **–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏** - –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
6. **ML-based –∞–≥–µ–Ω—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä** - –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –≤—ã–±–æ—Ä

### üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï (nice to have):
7. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** - –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
8. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 6.5/10

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç **–æ—Ç–ª–∏—á–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É** –∏ —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–≥–µ–Ω—Ç–æ–≤. –û–¥–Ω–∞–∫–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞** –¥–µ–ª–∞–µ—Ç AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω–µ–µ –ø–æ–ª–µ–∑–Ω—ã–º, —á–µ–º –æ–Ω –º–æ–≥ –±—ã –±—ã—Ç—å.

### –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:
1. ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ - –æ—Ç–ª–∏—á–Ω–∞—è
2. ‚úÖ –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ–ª–Ω–∞—è
3. ‚úÖ –•—Ä–∞–Ω–∏–ª–∏—â–µ - –Ω–∞–¥–µ–∂–Ω–æ–µ
4. ‚ùå **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**
5. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
6. ‚ö†Ô∏è –ü—Ä–æ–º–ø—Ç—ã - —Ö–æ—Ä–æ—à–∏–µ, –Ω–æ —Å—Ç–∞—Ç–∏—á–Ω—ã–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1**: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ AI API. –≠—Ç–æ –∑–∞–π–º–µ—Ç 1-2 —á–∞—Å–∞, –Ω–æ **–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç UX**.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2**: –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—Ç—Ä–∞—Ç.

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —ç—Ç–∏—Ö –¥–≤—É—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É **8.5/10**.

---

**–ê–≤—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏**: AI Assistant  
**–î–∞—Ç–∞**: 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0

---

## üìé –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### A. –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Quick Start)

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

```dart
// 1. –í AIService
Future<String> sendToOpenAI({
  required String message,
  required String systemPrompt,
  List<Message>? conversationHistory,
}) async {
  final messages = [
    {'role': 'system', 'content': systemPrompt},
    
    // –ò—Å—Ç–æ—Ä–∏—è
    ...?conversationHistory?.map((m) => {
      'role': m.type == MessageType.user ? 'user' : 'assistant',
      'content': m.content,
    }),
    
    // –¢–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    {'role': 'user', 'content': message},
  ];
  
  // ... –æ—Ç–ø—Ä–∞–≤–∫–∞
}

// 2. –í ChatProvider
Future<SmartAIResponse> _getSmartAIResponse(String userMessage) async {
  return await _aiService.sendMessageWithSmartSelection(
    message: userMessage,
    conversationHistory: _currentSession?.messages.take(10).toList(),
  );
}
```

–í—Å–µ–≥–æ **10 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** —Ä–µ—à–∞—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É!

---

### B. –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [OpenAI Chat Completions API](https://platform.openai.com/docs/guides/chat)
- [Google Gemini API](https://ai.google.dev/docs)
- [Token counting](https://github.com/openai/tiktoken)
- [Best practices for prompt engineering](https://platform.openai.com/docs/guides/prompt-engineering)

---

### C. FAQ

**Q: –°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏?**  
A: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏. –î–ª—è GPT-3.5: 10-15 —Å–æ–æ–±—â–µ–Ω–∏–π. –î–ª—è GPT-4/Gemini: 20-30.

**Q: –ö–∞–∫ —Å—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω—ã —Ç–æ—á–Ω–æ?**  
A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `tiktoken` –∏–ª–∏ API OpenAI.

**Q: –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏?**  
A: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏. GPT-4-vision –∏ Gemini –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç, –Ω–æ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç?**  
A: –ü—Ä–∏ —Å–º–µ–Ω–µ –∞–≥–µ–Ω—Ç–∞, –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

---

*–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞*

