# üé® –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Gemini Image Generation

## üéØ –¶–µ–ª—å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é Gemini 2.5 Flash Image –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ —á–∞—Ç–µ.

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### 1. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `sendImageGenerationToGemini()` –≤ `AIService`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å `gemini-2.5-flash-image-preview`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ, —Ç–∞–∫ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–µ

### 2. **–û–±–Ω–æ–≤–∏—Ç—å ChatProvider**
- –ó–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ `sendImageToOpenAI()` –Ω–∞ `sendImageGenerationToGemini()`
- –£–±—Ä–∞—Ç—å system prompt (–Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–º

### 3. **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ç–≤–µ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏**
- –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `ImageGenerationResponse`
- –°–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –æ—Ç–≤–µ—Ç–µ

### 4. **–û–±–Ω–æ–≤–∏—Ç—å MessageBubble**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—ã–µ, —Ç–∞–∫ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –†–∞–∑–¥–µ–ª–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –∏—Å—Ö–æ–¥–Ω—ã–µ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### 5. **–û–±–Ω–æ–≤–∏—Ç—å Message entity**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–ª–∏—á–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–ª–æ–∂–µ–Ω–∏–π

## üõ†Ô∏è –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å ImageGenerationResponse

```dart
class ImageGenerationResponse {
  final String textResponse;
  final List<Uint8List> generatedImages;
  final List<String> imageMimeTypes;
  
  const ImageGenerationResponse({
    required this.textResponse,
    required this.generatedImages,
    required this.imageMimeTypes,
  });
}
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ AIService

```dart
Future<ImageGenerationResponse> sendImageGenerationToGemini({
  required String prompt,
  required List<Uint8List> images,
  String model = 'gemini-2.5-flash-image-preview',
}) async {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ test_gemini_simple.dart
  // 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å parts —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
  // 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ Gemini API
  // 3. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–º
  // 4. –í–µ—Ä–Ω—É—Ç—å ImageGenerationResponse
}
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å ChatProvider

```dart
Future<void> sendMessageWithImages({
  required String content,
  required List<Uint8List> images,
}) async {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
  
  // ‚úÖ –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gemini –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  final response = await _aiService.sendImageGenerationToGemini(
    prompt: content.trim(),
    images: images,
  );
  
  // –°–æ–∑–¥–∞—Ç—å AI —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
  final aiMessage = Message.ai(
    id: _uuid.v4(),
    content: response.textResponse,
    agentId: 'gemini-image-generator',
    attachments: response.generatedImages.map((imageData) {
      return Attachment.image(
        id: _uuid.v4(),
        name: 'generated_${DateTime.now().millisecondsSinceEpoch}.jpg',
        data: imageData,
        mimeType: 'image/jpeg',
      );
    }).toList(),
  );
  
  _addMessageToCurrentSession(aiMessage);
}
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å MessageBubble

```dart
Widget _buildAttachments(BuildContext context) {
  // –†–∞–∑–¥–µ–ª–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  final originalImages = message.attachments?.where((a) => a.name.startsWith('image_')).toList() ?? [];
  final generatedImages = message.attachments?.where((a) => a.name.startsWith('generated_')).toList() ?? [];
  
  return Column(
    children: [
      // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      if (originalImages.isNotEmpty) ...[
        _buildImageSection(context, originalImages, '–ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'),
      ],
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      if (generatedImages.isNotEmpty) ...[
        _buildImageSection(context, generatedImages, '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã'),
      ],
    ],
  );
}
```

## üîç –ê–Ω–∞–ª–∏–∑ test_gemini_simple.dart

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:

1. **–ú–æ–¥–µ–ª—å**: `gemini-2.5-flash-image-preview`
2. **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞**: 
   ```dart
   'contents': [
     {
       'parts': [
         {'text': prompt},
         // ... –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ inline_data
       ]
     }
   ]
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞**:
   ```dart
   // –ü—Ä–æ–≤–µ—Ä—è–µ–º parts –≤ candidates
   for (final part in parts) {
     if (part['text'] != null) {
       // –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
     } else if (part['inline_data'] != null) {
       // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
     }
   }
   ```

4. **–ü—Ä–æ–∫—Å–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
- –¢–µ–∫—Å—Ç: "–æ–±—ä–µ–¥–∏–Ω–∏ —ç—Ç–∏ —Ñ–æ—Ç–æ –≤ –æ–¥–∏–Ω —É—á–∞—Å—Ç–æ–∫ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Å–∞–¥–æ–º –≤ —Å–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–æ–º —Å—Ç–∏–ª–µ —Å–¥–µ–ª–∞–π 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ –æ–ø–∏—à–∏ –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö"
- 4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—á–∞—Å—Ç–∫–∞

### AI –æ—Ç–≤–µ—á–∞–µ—Ç:
- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–∞–¥–∞
- 3 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –¥–∏–∑–∞–π–Ω–∞

### –í —á–∞—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
- –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç AI
- 3 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

1. **–í—ã—Å–æ–∫–∏–π**: –°–æ–∑–¥–∞—Ç—å ImageGenerationResponse
2. **–í—ã—Å–æ–∫–∏–π**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ sendImageGenerationToGemini
3. **–í—ã—Å–æ–∫–∏–π**: –û–±–Ω–æ–≤–∏—Ç—å ChatProvider –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞
4. **–°—Ä–µ–¥–Ω–∏–π**: –û–±–Ω–æ–≤–∏—Ç—å MessageBubble –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
5. **–ù–∏–∑–∫–∏–π**: –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑—É—á–µ–Ω—ã:
- ‚úÖ Gemini API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç–µ
- ‚úÖ –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ test_gemini_simple.dart
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üéâ
